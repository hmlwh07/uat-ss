"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9295,8757],{6517:(N,T,i)=>{i.d(T,{t7:()=>D});var m=i(5e3),f=i(19775),g=i(15439);const u=i.n(g)()||g,Y=new m.OlP("MAT_MOMENT_DATE_ADAPTER_OPTIONS",{providedIn:"root",factory:function E(){return{useUtc:!1}}});function b(l,t){const n=Array(l);for(let s=0;s<l;s++)n[s]=t(s);return n}let D=(()=>{class l extends f._A{constructor(n,s){super(),this._options=s,this.setLocale(n||u.locale())}setLocale(n){super.setLocale(n);let s=u.localeData(n);this._localeData={firstDayOfWeek:s.firstDayOfWeek(),longMonths:s.months(),shortMonths:s.monthsShort(),dates:b(31,M=>this.createDate(2017,0,M+1).format("D")),longDaysOfWeek:s.weekdays(),shortDaysOfWeek:s.weekdaysShort(),narrowDaysOfWeek:s.weekdaysMin()}}getYear(n){return this.clone(n).year()}getMonth(n){return this.clone(n).month()}getDate(n){return this.clone(n).date()}getDayOfWeek(n){return this.clone(n).day()}getMonthNames(n){return"long"==n?this._localeData.longMonths:this._localeData.shortMonths}getDateNames(){return this._localeData.dates}getDayOfWeekNames(n){return"long"==n?this._localeData.longDaysOfWeek:"short"==n?this._localeData.shortDaysOfWeek:this._localeData.narrowDaysOfWeek}getYearName(n){return this.clone(n).format("YYYY")}getFirstDayOfWeek(){return this._localeData.firstDayOfWeek}getNumDaysInMonth(n){return this.clone(n).daysInMonth()}clone(n){return n.clone().locale(this.locale)}createDate(n,s,M){const A=this._createMoment({year:n,month:s,date:M}).locale(this.locale);return A.isValid(),A}today(){return this._createMoment().locale(this.locale)}parse(n,s){return n&&"string"==typeof n?this._createMoment(n,s,this.locale):n?this._createMoment(n).locale(this.locale):null}format(n,s){return n=this.clone(n),this.isValid(n),n.format(s)}addCalendarYears(n,s){return this.clone(n).add({years:s})}addCalendarMonths(n,s){return this.clone(n).add({months:s})}addCalendarDays(n,s){return this.clone(n).add({days:s})}toIso8601(n){return this.clone(n).format()}deserialize(n){let s;if(n instanceof Date)s=this._createMoment(n).locale(this.locale);else if(this.isDateInstance(n))return this.clone(n);if("string"==typeof n){if(!n)return null;s=this._createMoment(n,u.ISO_8601).locale(this.locale)}return s&&this.isValid(s)?this._createMoment(s).locale(this.locale):super.deserialize(n)}isDateInstance(n){return u.isMoment(n)}isValid(n){return this.clone(n).isValid()}invalid(){return u.invalid()}_createMoment(n,s,M){const{strict:A,useUtc:C}=this._options||{};return C?u.utc(n,s,M,A):u(n,s,M,A)}}return l.\u0275fac=function(n){return new(n||l)(m.LFG(f.Ad,8),m.LFG(Y,8))},l.\u0275prov=m.Yz7({token:l,factory:l.\u0275fac}),l})()},55410:(N,T,i)=>{i.d(T,{Ys:()=>G,ou:()=>x,p3:()=>V});var m=i(70655),f=i(92340),g=i(38313),c=i(47423),u=(()=>{return(a=u||(u={})).Documents="DOCUMENTS",a.Data="DATA",a.Library="LIBRARY",a.Cache="CACHE",a.External="EXTERNAL",a.ExternalStorage="EXTERNAL_STORAGE",u;var a})();const D=(0,c.fo)("Filesystem",{web:()=>i.e(6364).then(i.bind(i,96364)).then(a=>new a.FilesystemWeb)}),w=(0,c.fo)("BlobWriter");function L(a){const d=new Uint8Array(a);let e="",o=0;for(;!(o>=d.byteLength);)e+=String.fromCharCode(d[o]),o+=1;return window.btoa(e)}function v(a,d,e){if(0===e.size)return Promise.resolve();const o=393216,r=e.slice(0,o);return new window.Response(r).arrayBuffer().then(function(p){return D.appendFile({directory:a,path:d,data:L(p)})}).then(function(){return v(a,d,e.slice(o))})}function F({path:a,directory:d,blob:e,recursive:o}){return D.writeFile({directory:d,path:a,recursive:o,data:""}).then(function({uri:r}){return v(d,a,e).then(function(){return r})})}const t=Object.freeze(function l(a){const{path:d,directory:e,blob:o,recursive:r,on_fallback:h}=a;return"ios"!==c.dV.platform&&"android"!==c.dV.platform?F(a):Promise.all([w.get_config(),D.getUri({path:d,directory:e})]).then(function([y,I]){const{base_url:W,auth_token:J}=y,k=I.uri.replace("file://","");return Promise.all([fetch(W+k+(r?"?recursive=true":""),{headers:{authorization:J},method:"put",body:o}),Promise.resolve(I)])}).then(function([p,y]){if(204!==p.status)throw new Error("Bad HTTP status: "+p.status);return y.uri}).catch(function(y){return void 0!==h&&h(y),F(a)})});var n=i(5e3),s=i(40520),M=i(94320),A=i(16164),C=i(43632),U=i(25492),P=i(96115);const Z=`${f.N.apiUrl}/attachment-uploader`;let V=(()=>{class a extends g.i{constructor(e){super(e,Z),this.httpClient=e}}return a.\u0275fac=function(e){return new(e||a)(n.LFG(s.eN))},a.\u0275prov=n.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})();const O=`${f.N.apiUrl}/attachment-downloader`,R=`${f.N.apiUrl}`;let G=(()=>{class a extends g.i{constructor(e,o,r,h,p,y){super(e,O),this.httpClient=e,this.file=o,this.loadingService=r,this.toastService=h,this.alertService=p,this.translate=y}getFile(e){return this.httpClient.get(R+e,{responseType:"blob"})}get(e,o){return this.httpClient.get(R+e,{params:o})}mobileTCSDownload(e,o){return(0,m.mG)(this,void 0,void 0,function*(){URL.createObjectURL(o),this.file.checkDir(this.file.externalRootDirectory,"kbzms_downloads").then(h=>{this.createFile(e,o)}).catch(h=>{this.file.createDir(this.file.externalRootDirectory,"kbzms_downloads",!1).then(p=>{this.createFile(e,o)}).catch(p=>(0,m.mG)(this,void 0,void 0,function*(){console.log(p),yield this.loadingService.deactivate();let y=this.translate.transform("ERROR.file_error");this.alertService.activate(y,"Download File")}))})})}downloadTCSFile(e,o){var r=document.createElement("a");r.href=URL.createObjectURL(e),r.download=o,r.click();let h=this.translate.transform("ERROR.download_success");this.alertService.activate(h,"Download File"),r.remove()}getDownload(e,o){this.httpClient.get(O+"/"+e,{responseType:"blob"}).toPromise().then(r=>{r&&(c.dV.isNativePlatform()?this.mobileDownload(o,r):this.downloadFile(r,o))})}downloadFile(e,o){var r=document.createElement("a");r.href=URL.createObjectURL(e),r.download=o,r.click(),r.remove()}mobileDownload(e,o){return(0,m.mG)(this,void 0,void 0,function*(){try{yield D.mkdir({path:"kbzsale_downloads",directory:u.Documents,recursive:!1}),this.createFile(e,o)}catch(r){this.createFile(e,o)}})}createFile(e,o){return(0,m.mG)(this,void 0,void 0,function*(){try{yield t({path:"kbzsale_downloads/"+e,directory:u.Documents,blob:o}),yield this.loadingService.deactivate(),this.alertService.activate('"Download File',"Success Message")}catch(r){yield this.loadingService.deactivate(),this.alertService.activate('"Download Fail',"Error Message")}})}}return a.\u0275fac=function(e){return new(e||a)(n.LFG(s.eN),n.LFG(M.$),n.LFG(A.b),n.LFG(C.T),n.LFG(U.c),n.LFG(P.K))},a.\u0275prov=n.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})();const S=`${f.N.apiUrl}/attachment-ref`;let x=(()=>{class a extends g.i{constructor(e){super(e,S),this.httpClient=e}getAttachmentListRef(e,o){return this.httpClient.get(S+"?refDocNo="+e+"&refDocType="+o)}}return a.\u0275fac=function(e){return new(e||a)(n.LFG(s.eN))},a.\u0275prov=n.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})()},88757:(N,T,i)=>{function m(u){try{JSON.parse(u)}catch(Y){return!1}return!0}i.d(T,{Gs:()=>f,Ny:()=>c,cU:()=>m});const f={parse:{dateInput:"DD-MM-YYYY"},display:{dateInput:"DD-MM-YYYY",monthYearLabel:"MMMM YYYY",dateA11yLabel:"LL",monthYearA11yLabel:"MMMM YYYY"}},c={parse:{dateInput:"MM-YYYY"},display:{dateInput:"MM-YYYY",monthYearLabel:"MM-YYYY",dateA11yLabel:"LL",monthYearA11yLabel:"MM-YYYY"}}},3663:(N,T,i)=>{i.r(T),i.d(T,{RenewManagementListModule:()=>x});var m=i(69808),f=i(96592),g=i(70655),c=i(93075),u=i(47423),Y=i(15439),E=i(39646),b=i(95577),D=i(54004),w=i(70262),L=i(93230),v=i(34436);const F=[{title:"Policy Number",type:v.Y.FEILD,field:"policyNumber"},{title:"Product Code",type:v.Y.FEILD,field:"productCode"},{title:"Agent Name",type:v.Y.FEILD,field:"agentName"},{title:"Premium",type:v.Y.FEILD,field:"premium",amtFormat:!0},{title:"Currency",type:v.Y.FEILD,field:"currency"},{title:"Policy Inception Date",type:v.Y.FEILD,field:"policyInceptionDate"},{title:"Policy Expiry Date",type:v.Y.FEILD,field:"policyExpiryDate"},{title:"Status",type:v.Y.FEILD,field:"status",isRenewStatus:!0},{title:"Actions",type:v.Y.ACTION,field:"actions",btn:{confirm:!0,view:!0,download:!0}}],l=["policyNumber","productCode","agentName","premium","currency","policyInceptionDate","policyExpiryDate","status","actions"];var t=i(5e3),n=i(84161),s=i(25492),M=i(16164),A=i(55410),C=i(32157),U=i(65435),P=i(98807);const Z=function(a){return{activated:a}};let V=(()=>{class a{constructor(e,o,r,h,p,y,I){this.fb=e,this.router=o,this.cdf=r,this.renewService=h,this.alertService=p,this.loadingService=y,this.attachmentDownloadService=I,this.ELEMENT_COL=F,this.displayedColumns=l,this.renewList=[],this.isTeam=!1,this.activityStatus=v.f,this.downED="/attachment-downloader/tcs/fileName=",this.loadForm()}ngOnInit(){}ngAfterViewInit(){this.getList()}cancel(){this.actForm.reset(),this.getOneMonthAndRefresh(),this.getList()}loadForm(){this.actForm=new c.cw({policyNumber:new c.NI(""),policyHolder:new c.NI(""),productCode:new c.NI(""),startDate:new c.NI(""),endDate:new c.NI(""),isTeam:new c.NI(this.isTeam)})}getOneMonthAndRefresh(){let e=new Date,o=new Date(e.setMonth(e.getMonth()-1)),r=new Date(e.setMonth(e.getMonth()+1));this.actForm.controls.startDate.setValue(o.toISOString()),this.actForm.controls.endDate.setValue(r.toISOString()),this.actForm.controls.policyNumber.setValue(""),this.actForm.controls.policyHolder.setValue(""),this.actForm.controls.productCode.setValue(""),this.actForm.controls.isTeam.setValue(this.isTeam)}getList(){let e={policyNumber:this.actForm.controls.policyNumber.value||"",policyHolder:this.actForm.controls.policyHolder.value||"",productCode:this.actForm.controls.productCode.value||"",fromDate:null!=this.actForm.controls.startDate.value?Y(this.actForm.controls.startDate.value).format("YYYY-MM-DD"):"",toDate:null!=this.actForm.controls.endDate.value?Y(this.actForm.controls.endDate.value).format("YYYY-MM-DD"):"",isTeam:this.isTeam};this.renewService.getRenewList(e).toPromise().then(o=>{o&&(this.renewList=o,this.cdf.detectChanges(),this.matTable.reChangeData())})}actionBtn(e){"edit"==e.cmd||"view"==e.cmd?this.navigateToDetail(e.data):"confirm"==e.cmd?this.confirmRenew(e.data):"download"==e.cmd&&this.download(e.data.documentName)}isControlValid(e){const o=this.actForm.controls[e];return o.valid&&(o.dirty||o.touched)}isControlInvalid(e){const o=this.actForm.controls[e];return o.invalid&&(o.dirty||o.touched)}controlHasError(e,o){const r=this.actForm.controls[o];return r.hasError(e)&&(r.dirty||r.touched)}isControlTouched(e){const o=this.actForm.controls[e];return o.dirty||o.touched}navigateToDetail(e){this.router.navigate(["sales/renew-policy/detail"],{queryParams:{data:JSON.stringify(e)}})}confirmRenew(e){"confirm"!=e.status&&this.alertService.activate("Are you sure want to confirm?","Warning Message").then(o=>(0,g.mG)(this,void 0,void 0,function*(){o&&this.renewService.confirmRenew(e.policyNumber).toPromise().then(r=>{r&&(console.log(r),this.alertService.activate("This record was updated","Success Message"),this.navigateToDetail(r))})}))}download(e){return(0,g.mG)(this,void 0,void 0,function*(){yield this.loadingService.activate(),this.getFileExt(e).pipe((0,b.z)(o=>{let r=o?o.docExtension:"pdf";return this.attachmentDownloadService.getFile(this.downED+e+"."+r).pipe((0,D.U)(h=>({data:h,ext:r})))})).toPromise().then(o=>(0,g.mG)(this,void 0,void 0,function*(){o&&(u.dV.isNativePlatform()?this.attachmentDownloadService.mobileTCSDownload(e+"."+o.ext,o.data):(yield this.loadingService.deactivate(),this.attachmentDownloadService.downloadTCSFile(o.data,e+"."+o.ext))),yield this.loadingService.deactivate()})).catch(o=>(0,g.mG)(this,void 0,void 0,function*(){yield this.loadingService.deactivate()}))})}getFileExt(e){return this.attachmentDownloadService.get(this.downED+e).pipe((0,w.K)(()=>(0,E.of)(null)))}changeView(e){this.isTeam="team"==e,this.actForm.controls.isTeam.setValue(this.isTeam),this.cdf.detectChanges(),this.getList()}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(c.qu),t.Y36(f.F0),t.Y36(t.sBO),t.Y36(n.R),t.Y36(s.c),t.Y36(M.b),t.Y36(A.Ys))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-renew-management-list"]],viewQuery:function(e,o){if(1&e&&t.Gf(L.I,5),2&e){let r;t.iGM(r=t.CRH())&&(o.matTable=r.first)}},decls:53,vars:45,consts:[[1,"row"],[1,"col-12","text-right","pb-5"],[1,"btn","btn-light-dark","new-btn-dark-gray","mr-2","btn-round",3,"ngClass","click"],[1,"btn","btn-light-dark","new-btn-dark-gray","btn-round",3,"ngClass","click"],[1,"col-12"],[1,"card","card-custom","gutter-b","data"],[1,"card-header"],[1,"card-title"],[1,"card-label","left-border-image"],[1,"card-toolbar"],[1,"flaticon2-magnifier-tool","search-tool",3,"click"],["type","button",1,"btn","btn-primary","ml-2",2,"min-width","50px",3,"click"],[1,""],[1,"card-body","px-10","py-3"],["action","#",1,"form",3,"formGroup"],[1,"row",2,"align-items","center"],["remove-host","",3,"formInput","colClass"],[1,"col-md-6"],[1,"form-group","row"],[1,"col-sm-4","col-form-label"],[1,"col-sm-8"],["type","text","name","policyNumber","autocomplete","off","formControlName","policyNumber",1,"form-control","form-control-sm"],["type","text","name","policyHolder","autocomplete","off","formControlName","policyHolder",1,"form-control","form-control-sm"],["type","text","name","productCode","autocomplete","off","formControlName","productCode",1,"form-control","form-control-sm"],[1,"card","card-custom","gutter-b"],[1,"card-body","customer-card-body"],[3,"data","colum","displayedColumns","emitter"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.TgZ(2,"button",2),t.NdJ("click",function(){return o.changeView("myview")}),t._uU(3),t.ALo(4,"translate"),t.qZA(),t.TgZ(5,"button",3),t.NdJ("click",function(){return o.changeView("team")}),t._uU(6),t.ALo(7,"translate"),t.qZA(),t.qZA(),t.TgZ(8,"div",4),t.TgZ(9,"div",5),t.TgZ(10,"div",6),t.TgZ(11,"div",7),t.TgZ(12,"h3",8),t._uU(13),t.ALo(14,"translate"),t.qZA(),t.qZA(),t.TgZ(15,"div",9),t.TgZ(16,"span",10),t.NdJ("click",function(){return o.getList()}),t.qZA(),t.TgZ(17,"button",11),t.NdJ("click",function(){return o.cancel()}),t.TgZ(18,"span",12),t._uU(19),t.ALo(20,"translate"),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(21,"div",13),t.TgZ(22,"form",14),t.TgZ(23,"div",15),t._UZ(24,"app-start-end-date",16),t.qZA(),t.TgZ(25,"div",15),t.TgZ(26,"div",17),t.TgZ(27,"div",18),t.TgZ(28,"label",19),t._uU(29),t.ALo(30,"translate"),t.qZA(),t.TgZ(31,"div",20),t._UZ(32,"input",21),t.qZA(),t.qZA(),t.qZA(),t.TgZ(33,"div",17),t.TgZ(34,"div",18),t.TgZ(35,"label",19),t._uU(36),t.ALo(37,"translate"),t.qZA(),t.TgZ(38,"div",20),t._UZ(39,"input",22),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(40,"div",15),t.TgZ(41,"div",17),t.TgZ(42,"div",18),t.TgZ(43,"label",19),t._uU(44),t.ALo(45,"translate"),t.qZA(),t.TgZ(46,"div",20),t._UZ(47,"input",23),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(48,"div",0),t.TgZ(49,"div",4),t.TgZ(50,"div",24),t.TgZ(51,"div",25),t.TgZ(52,"app-material-table-view",26),t.NdJ("emitter",function(h){return o.actionBtn(h)}),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA()),2&e&&(t.xp6(2),t.Q6J("ngClass",t.VKq(41,Z,!o.isTeam)),t.xp6(1),t.Oqu(t.lcZ(4,27,"FORM.my_view")),t.xp6(2),t.Q6J("ngClass",t.VKq(43,Z,o.isTeam)),t.xp6(1),t.Oqu(t.lcZ(7,29,"FORM.team_veiw")),t.xp6(7),t.Oqu(t.lcZ(14,31,"FORM.renewal_list")),t.xp6(6),t.Oqu(t.lcZ(20,33,"FORM.btn_cancel")),t.xp6(3),t.Q6J("formGroup",o.actForm),t.xp6(2),t.Q6J("formInput",o.actForm)("colClass","col-md-6"),t.xp6(5),t.Oqu(t.lcZ(30,35,"FORM.policy_no")),t.xp6(3),t.ekj("is-invalid",o.isControlInvalid("policyNumber"))("is-valid",o.isControlValid("policyNumber")),t.xp6(4),t.Oqu(t.lcZ(37,37,"FORM.policy_holder")),t.xp6(3),t.ekj("is-invalid",o.isControlInvalid("policyHolder"))("is-valid",o.isControlValid("policyHolder")),t.xp6(5),t.Oqu(t.lcZ(45,39,"FORM.product_code")),t.xp6(3),t.ekj("is-invalid",o.isControlInvalid("productCode"))("is-valid",o.isControlValid("productCode")),t.xp6(5),t.Q6J("data",o.renewList)("colum",o.ELEMENT_COL)("displayedColumns",o.displayedColumns))},directives:[m.mk,c._Y,c.JL,c.sg,C.Q,U.Z,c.Fj,c.JJ,c.u,L.I],pipes:[P.X],styles:[".col-form-label[_ngcontent-%COMP%]{padding-top:0;padding-bottom:0}.form-group.row[_ngcontent-%COMP%]{align-items:center}.activated[_ngcontent-%COMP%]{background-color:#ff8100!important;color:#fff!important}"]}),a})();var O=i(69544),R=i(50282),G=i(64537),S=i(7181);let x=(()=>{class a{}return a.\u0275fac=function(e){return new(e||a)},a.\u0275mod=t.oAB({type:a}),a.\u0275inj=t.cJS({imports:[[m.ez,c.u5,c.UX,O.vi,R.fA,G.A0,S.j,f.Bz.forChild([{path:"",component:V}])]]}),a})()}}]);