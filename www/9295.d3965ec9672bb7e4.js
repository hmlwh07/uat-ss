"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9295,8757],{6517:(N,T,a)=>{a.d(T,{t7:()=>D});var u=a(5e3),p=a(19775),g=a(15439);const h=a.n(g)()||g,Y=new u.OlP("MAT_MOMENT_DATE_ADAPTER_OPTIONS",{providedIn:"root",factory:function O(){return{useUtc:!1}}});function b(d,t){const o=Array(d);for(let s=0;s<d;s++)o[s]=t(s);return o}let D=(()=>{class d extends p._A{constructor(o,s){super(),this._options=s,this.setLocale(o||h.locale())}setLocale(o){super.setLocale(o);let s=h.localeData(o);this._localeData={firstDayOfWeek:s.firstDayOfWeek(),longMonths:s.months(),shortMonths:s.monthsShort(),dates:b(31,M=>this.createDate(2017,0,M+1).format("D")),longDaysOfWeek:s.weekdays(),shortDaysOfWeek:s.weekdaysShort(),narrowDaysOfWeek:s.weekdaysMin()}}getYear(o){return this.clone(o).year()}getMonth(o){return this.clone(o).month()}getDate(o){return this.clone(o).date()}getDayOfWeek(o){return this.clone(o).day()}getMonthNames(o){return"long"==o?this._localeData.longMonths:this._localeData.shortMonths}getDateNames(){return this._localeData.dates}getDayOfWeekNames(o){return"long"==o?this._localeData.longDaysOfWeek:"short"==o?this._localeData.shortDaysOfWeek:this._localeData.narrowDaysOfWeek}getYearName(o){return this.clone(o).format("YYYY")}getFirstDayOfWeek(){return this._localeData.firstDayOfWeek}getNumDaysInMonth(o){return this.clone(o).daysInMonth()}clone(o){return o.clone().locale(this.locale)}createDate(o,s,M){const A=this._createMoment({year:o,month:s,date:M}).locale(this.locale);return A.isValid(),A}today(){return this._createMoment().locale(this.locale)}parse(o,s){return o&&"string"==typeof o?this._createMoment(o,s,this.locale):o?this._createMoment(o).locale(this.locale):null}format(o,s){return o=this.clone(o),this.isValid(o),o.format(s)}addCalendarYears(o,s){return this.clone(o).add({years:s})}addCalendarMonths(o,s){return this.clone(o).add({months:s})}addCalendarDays(o,s){return this.clone(o).add({days:s})}toIso8601(o){return this.clone(o).format()}deserialize(o){let s;if(o instanceof Date)s=this._createMoment(o).locale(this.locale);else if(this.isDateInstance(o))return this.clone(o);if("string"==typeof o){if(!o)return null;s=this._createMoment(o,h.ISO_8601).locale(this.locale)}return s&&this.isValid(s)?this._createMoment(s).locale(this.locale):super.deserialize(o)}isDateInstance(o){return h.isMoment(o)}isValid(o){return this.clone(o).isValid()}invalid(){return h.invalid()}_createMoment(o,s,M){const{strict:A,useUtc:C}=this._options||{};return C?h.utc(o,s,M,A):h(o,s,M,A)}}return d.\u0275fac=function(o){return new(o||d)(u.LFG(p.Ad,8),u.LFG(Y,8))},d.\u0275prov=u.Yz7({token:d,factory:d.\u0275fac}),d})()},55410:(N,T,a)=>{a.d(T,{Ys:()=>G,ou:()=>J,p3:()=>V});var u=a(70655),p=a(92340),g=a(38313),m=a(47423),h=(()=>{return(r=h||(h={})).Documents="DOCUMENTS",r.Data="DATA",r.Library="LIBRARY",r.Cache="CACHE",r.External="EXTERNAL",r.ExternalStorage="EXTERNAL_STORAGE",h;var r})();const D=(0,m.fo)("Filesystem",{web:()=>a.e(6364).then(a.bind(a,96364)).then(r=>new r.FilesystemWeb)}),w=(0,m.fo)("BlobWriter");function L(r){const c=new Uint8Array(r);let i="",e=0;for(;!(e>=c.byteLength);)i+=String.fromCharCode(c[e]),e+=1;return window.btoa(i)}function v(r,c,i){if(0===i.size)return Promise.resolve();const e=393216,n=i.slice(0,e);return new window.Response(n).arrayBuffer().then(function(f){return D.appendFile({directory:r,path:c,data:L(f)})}).then(function(){return v(r,c,i.slice(e))})}function F({path:r,directory:c,blob:i,recursive:e}){return D.writeFile({directory:c,path:r,recursive:e,data:""}).then(function({uri:n}){return v(c,r,i).then(function(){return n})})}const t=Object.freeze(function d(r){const{path:c,directory:i,blob:e,recursive:n,on_fallback:l}=r;return"ios"!==m.dV.platform&&"android"!==m.dV.platform?F(r):Promise.all([w.get_config(),D.getUri({path:c,directory:i})]).then(function([y,I]){const{base_url:W,auth_token:x}=y,z=I.uri.replace("file://","");return Promise.all([fetch(W+z+(n?"?recursive=true":""),{headers:{authorization:x},method:"put",body:e}),Promise.resolve(I)])}).then(function([f,y]){if(204!==f.status)throw new Error("Bad HTTP status: "+f.status);return y.uri}).catch(function(y){return void 0!==l&&l(y),F(r)})});var o=a(5e3),s=a(40520),M=a(94320),A=a(16164),C=a(43632),P=a(25492),U=a(96115);const Z=`${p.N.apiUrl}/attachment-uploader`;let V=(()=>{class r extends g.i{constructor(i){super(i,Z),this.httpClient=i}}return r.\u0275fac=function(i){return new(i||r)(o.LFG(s.eN))},r.\u0275prov=o.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();const E=`${p.N.apiUrl}/attachment-downloader`,R=`${p.N.apiUrl}`;let G=(()=>{class r extends g.i{constructor(i,e,n,l,f,y){super(i,E),this.httpClient=i,this.file=e,this.loadingService=n,this.toastService=l,this.alertService=f,this.translate=y}getFile(i){return this.httpClient.get(R+i,{responseType:"blob"})}get(i,e){return this.httpClient.get(R+i,{params:e})}mobileTCSDownload(i,e){return(0,u.mG)(this,void 0,void 0,function*(){URL.createObjectURL(e),this.file.checkDir(this.file.externalRootDirectory,"kbzms_downloads").then(l=>{this.createFile(i,e)}).catch(l=>{this.file.createDir(this.file.externalRootDirectory,"kbzms_downloads",!1).then(f=>{this.createFile(i,e)}).catch(f=>(0,u.mG)(this,void 0,void 0,function*(){console.log(f),yield this.loadingService.deactivate();let y=this.translate.transform("ERROR.file_error");this.alertService.activate(y,"Download File")}))})})}downloadTCSFile(i,e){var n=document.createElement("a");n.href=URL.createObjectURL(i),n.download=e,n.click();let l=this.translate.transform("ERROR.download_success");this.alertService.activate(l,"Download File"),n.remove()}getDownload(i,e){this.httpClient.get(E+"/"+i,{responseType:"blob"}).toPromise().then(n=>{n&&(m.dV.isNativePlatform()?this.mobileDownload(e,n):this.downloadFile(n,e))})}downloadFile(i,e){var n=document.createElement("a");n.href=URL.createObjectURL(i),n.download=e,n.click(),n.remove()}mobileDownload(i,e){return(0,u.mG)(this,void 0,void 0,function*(){try{yield D.mkdir({path:"kbzsale_downloads",directory:h.Documents,recursive:!1}),this.createFile(i,e)}catch(n){this.createFile(i,e)}})}createFile(i,e){return(0,u.mG)(this,void 0,void 0,function*(){try{yield t({path:"kbzsale_downloads/"+i,directory:h.Documents,blob:e}),yield this.loadingService.deactivate(),this.alertService.activate('"Download File',"Success Message")}catch(n){yield this.loadingService.deactivate(),this.alertService.activate('"Download Fail',"Error Message")}})}}return r.\u0275fac=function(i){return new(i||r)(o.LFG(s.eN),o.LFG(M.$),o.LFG(A.b),o.LFG(C.T),o.LFG(P.c),o.LFG(U.K))},r.\u0275prov=o.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();const S=`${p.N.apiUrl}/attachment-ref`;let J=(()=>{class r extends g.i{constructor(i){super(i,S),this.httpClient=i}getAttachmentListRef(i,e){return this.httpClient.get(S+"?refDocNo="+i+"&refDocType="+e)}}return r.\u0275fac=function(i){return new(i||r)(o.LFG(s.eN))},r.\u0275prov=o.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),r})()},88757:(N,T,a)=>{function u(h){try{JSON.parse(h)}catch(Y){return!1}return!0}a.d(T,{Gs:()=>p,Ny:()=>m,cU:()=>u});const p={parse:{dateInput:"DD-MM-YYYY"},display:{dateInput:"DD-MM-YYYY",monthYearLabel:"MMMM YYYY",dateA11yLabel:"LL",monthYearA11yLabel:"MMMM YYYY"}},m={parse:{dateInput:"MM-YYYY"},display:{dateInput:"MM-YYYY",monthYearLabel:"MM-YYYY",dateA11yLabel:"LL",monthYearA11yLabel:"MM-YYYY"}}},3663:(N,T,a)=>{a.r(T),a.d(T,{RenewManagementListModule:()=>r});var u=a(69808),p=a(96592),g=a(70655),m=a(93075),h=a(47423),Y=a(15439),O=a(39646),b=a(95577),D=a(54004),w=a(70262),L=a(93230),v=a(34436);const F=[{title:"Policy Number",type:v.Y.FEILD,field:"policyNumber"},{title:"Product Code",type:v.Y.FEILD,field:"productCode"},{title:"Agent Name",type:v.Y.FEILD,field:"agentName"},{title:"Premium",type:v.Y.FEILD,field:"premium",amtFormat:!0},{title:"Currency",type:v.Y.FEILD,field:"currency"},{title:"Policy Inception Date",type:v.Y.FEILD,field:"policyInceptionDate"},{title:"Policy Expiry Date",type:v.Y.FEILD,field:"policyExpiryDate"},{title:"Status",type:v.Y.FEILD,field:"status",isRenewStatus:!0},{title:"Actions",type:v.Y.ACTION,field:"actions",btn:{confirm:!0,view:!0,download:!0}}],d=["policyNumber","productCode","agentName","premium","currency","policyInceptionDate","policyExpiryDate","status","actions"];var t=a(5e3),o=a(84161),s=a(25492),M=a(16164),A=a(55410),C=a(78680),P=a(32157),U=a(65435),Z=a(64537),V=a(98807);const E=function(c){return{activated:c}};let R=(()=>{class c{constructor(e,n,l,f,y,I,W,x){this.fb=e,this.router=n,this.cdf=l,this.renewService=f,this.alertService=y,this.loadingService=I,this.attachmentDownloadService=W,this.prodctService=x,this.ELEMENT_COL=F,this.displayedColumns=d,this.renewList=[],this.isTeam=!1,this.activityStatus=v.f,this.productOption=[],this.statusOption=[{code:"ACTIVE",value:"ACTIVE"},{code:"CONFIRM",value:"CONFIRM"}],this.downED="/attachment-downloader/tcs/fileName=",this.loadForm()}ngOnInit(){this.getProduct()}ngAfterViewInit(){this.getList()}cancel(){this.actForm.reset(),this.getOneMonthAndRefresh(),this.getList()}loadForm(){this.actForm=new m.cw({policyNumber:new m.NI(""),policyHolder:new m.NI(""),productCode:new m.NI(""),startDate:new m.NI(""),endDate:new m.NI(""),isTeam:new m.NI(this.isTeam)})}getOneMonthAndRefresh(){let e=new Date,n=new Date(e.setMonth(e.getMonth()-1)),l=new Date(e.setMonth(e.getMonth()+1));this.actForm.controls.startDate.setValue(n.toISOString()),this.actForm.controls.endDate.setValue(l.toISOString()),this.actForm.controls.policyNumber.setValue(""),this.actForm.controls.policyHolder.setValue(""),this.actForm.controls.productCode.setValue(""),this.actForm.controls.isTeam.setValue(this.isTeam)}getList(){let e={policyNumber:this.actForm.controls.policyNumber.value||"",policyHolder:this.actForm.controls.policyHolder.value||"",productCode:this.actForm.controls.productCode.value||"",fromDate:null!=this.actForm.controls.startDate.value?Y(this.actForm.controls.startDate.value).format("YYYY-MM-DD"):"",toDate:null!=this.actForm.controls.endDate.value?Y(this.actForm.controls.endDate.value).format("YYYY-MM-DD"):"",isTeam:this.isTeam};this.renewService.getRenewList(e).toPromise().then(n=>{n&&(this.renewList=n,this.cdf.detectChanges(),this.matTable.reChangeData())})}actionBtn(e){"edit"==e.cmd||"view"==e.cmd?this.navigateToDetail(e.data):"confirm"==e.cmd?this.confirmRenew(e.data):"download"==e.cmd&&this.download(e.data.documentName)}isControlValid(e){const n=this.actForm.controls[e];return n.valid&&(n.dirty||n.touched)}isControlInvalid(e){const n=this.actForm.controls[e];return n.invalid&&(n.dirty||n.touched)}controlHasError(e,n){const l=this.actForm.controls[n];return l.hasError(e)&&(l.dirty||l.touched)}isControlTouched(e){const n=this.actForm.controls[e];return n.dirty||n.touched}navigateToDetail(e){this.router.navigate(["sales/renew-policy/detail"],{queryParams:{data:JSON.stringify(e)}})}confirmRenew(e){"confirm"!=e.status&&this.alertService.activate("Are you sure want to confirm?","Warning Message").then(n=>(0,g.mG)(this,void 0,void 0,function*(){n&&this.renewService.confirmRenew(e.policyNumber).toPromise().then(l=>{l&&(console.log(l),this.alertService.activate("This record was updated","Success Message"),this.navigateToDetail(l))})}))}download(e){return(0,g.mG)(this,void 0,void 0,function*(){yield this.loadingService.activate(),this.getFileExt(e).pipe((0,b.z)(n=>{let l=n?n.docExtension:"pdf";return this.attachmentDownloadService.getFile(this.downED+e+"."+l).pipe((0,D.U)(f=>({data:f,ext:l})))})).toPromise().then(n=>(0,g.mG)(this,void 0,void 0,function*(){n&&(h.dV.isNativePlatform()?this.attachmentDownloadService.mobileTCSDownload(e+"."+n.ext,n.data):(yield this.loadingService.deactivate(),this.attachmentDownloadService.downloadTCSFile(n.data,e+"."+n.ext))),yield this.loadingService.deactivate()})).catch(n=>(0,g.mG)(this,void 0,void 0,function*(){yield this.loadingService.deactivate()}))})}getFileExt(e){return this.attachmentDownloadService.get(this.downED+e).pipe((0,w.K)(()=>(0,O.of)(null)))}getProduct(){this.prodctService.getAll("yes").toPromise().then(e=>{e&&(this.product=e,this.productOption=e.map(n=>({code:n.code,value:n.name,type:n.type})),this.cdf.detectChanges())})}clear(e){"productCode"==e&&this.actForm.controls[e].setValue(null)}changeView(e){this.isTeam="team"==e,this.actForm.controls.isTeam.setValue(this.isTeam),this.cdf.detectChanges(),this.getList()}}return c.\u0275fac=function(e){return new(e||c)(t.Y36(m.qu),t.Y36(p.F0),t.Y36(t.sBO),t.Y36(o.R),t.Y36(s.c),t.Y36(M.b),t.Y36(A.Ys),t.Y36(C.f))},c.\u0275cmp=t.Xpm({type:c,selectors:[["app-renew-management-list"]],viewQuery:function(e,n){if(1&e&&t.Gf(L.I,5),2&e){let l;t.iGM(l=t.CRH())&&(n.matTable=l.first)}},decls:53,vars:42,consts:[[1,"row"],[1,"col-12","text-right","pb-5"],[1,"btn","btn-light-dark","new-btn-dark-gray","mr-2","btn-round",3,"ngClass","click"],[1,"btn","btn-light-dark","new-btn-dark-gray","btn-round",3,"ngClass","click"],[1,"col-12"],[1,"card","card-custom","gutter-b","data"],[1,"card-header"],[1,"card-title"],[1,"card-label","left-border-image"],[1,"card-toolbar"],[1,"flaticon2-magnifier-tool","search-tool",3,"click"],["type","button",1,"btn","btn-primary","ml-2",2,"min-width","50px",3,"click"],[1,""],[1,"card-body","px-10","py-3"],["action","#",1,"form",3,"formGroup"],[1,"row",2,"align-items","center"],["remove-host","",3,"formInput","colClass"],[1,"col-md-6"],[1,"form-group","row"],[1,"col-sm-4","col-form-label"],[1,"col-sm-8"],["type","text","name","policyNumber","autocomplete","off","formControlName","policyNumber",1,"form-control","form-control-sm"],["type","text","name","policyHolder","autocomplete","off","formControlName","policyHolder",1,"form-control","form-control-sm"],["bindLabel","value","bindValue","code","formControlName","productCode",1,"ng-custom-select",3,"items","clear"],[1,"card","card-custom","gutter-b"],[1,"card-body","customer-card-body"],[3,"data","colum","displayedColumns","emitter"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.TgZ(2,"button",2),t.NdJ("click",function(){return n.changeView("myview")}),t._uU(3),t.ALo(4,"translate"),t.qZA(),t.TgZ(5,"button",3),t.NdJ("click",function(){return n.changeView("team")}),t._uU(6),t.ALo(7,"translate"),t.qZA(),t.qZA(),t.TgZ(8,"div",4),t.TgZ(9,"div",5),t.TgZ(10,"div",6),t.TgZ(11,"div",7),t.TgZ(12,"h3",8),t._uU(13),t.ALo(14,"translate"),t.qZA(),t.qZA(),t.TgZ(15,"div",9),t.TgZ(16,"span",10),t.NdJ("click",function(){return n.getList()}),t.qZA(),t.TgZ(17,"button",11),t.NdJ("click",function(){return n.cancel()}),t.TgZ(18,"span",12),t._uU(19),t.ALo(20,"translate"),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(21,"div",13),t.TgZ(22,"form",14),t.TgZ(23,"div",15),t._UZ(24,"app-start-end-date",16),t.qZA(),t.TgZ(25,"div",15),t.TgZ(26,"div",17),t.TgZ(27,"div",18),t.TgZ(28,"label",19),t._uU(29),t.ALo(30,"translate"),t.qZA(),t.TgZ(31,"div",20),t._UZ(32,"input",21),t.qZA(),t.qZA(),t.qZA(),t.TgZ(33,"div",17),t.TgZ(34,"div",18),t.TgZ(35,"label",19),t._uU(36),t.ALo(37,"translate"),t.qZA(),t.TgZ(38,"div",20),t._UZ(39,"input",22),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(40,"div",15),t.TgZ(41,"div",17),t.TgZ(42,"div",18),t.TgZ(43,"label",19),t._uU(44),t.ALo(45,"translate"),t.qZA(),t.TgZ(46,"div",20),t.TgZ(47,"ng-select",23),t.NdJ("clear",function(){return n.clear("productCode")}),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(48,"div",0),t.TgZ(49,"div",4),t.TgZ(50,"div",24),t.TgZ(51,"div",25),t.TgZ(52,"app-material-table-view",26),t.NdJ("emitter",function(f){return n.actionBtn(f)}),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA()),2&e&&(t.xp6(2),t.Q6J("ngClass",t.VKq(38,E,!n.isTeam)),t.xp6(1),t.Oqu(t.lcZ(4,24,"FORM.my_view")),t.xp6(2),t.Q6J("ngClass",t.VKq(40,E,n.isTeam)),t.xp6(1),t.Oqu(t.lcZ(7,26,"FORM.team_veiw")),t.xp6(7),t.Oqu(t.lcZ(14,28,"FORM.renewal_list")),t.xp6(6),t.Oqu(t.lcZ(20,30,"FORM.btn_cancel")),t.xp6(3),t.Q6J("formGroup",n.actForm),t.xp6(2),t.Q6J("formInput",n.actForm)("colClass","col-md-6"),t.xp6(5),t.Oqu(t.lcZ(30,32,"FORM.policy_no")),t.xp6(3),t.ekj("is-invalid",n.isControlInvalid("policyNumber"))("is-valid",n.isControlValid("policyNumber")),t.xp6(4),t.Oqu(t.lcZ(37,34,"FORM.policy_holder")),t.xp6(3),t.ekj("is-invalid",n.isControlInvalid("policyHolder"))("is-valid",n.isControlValid("policyHolder")),t.xp6(5),t.hij(" ",t.lcZ(45,36,"FORM.product_name"),""),t.xp6(3),t.Q6J("items",n.productOption),t.xp6(5),t.Q6J("data",n.renewList)("colum",n.ELEMENT_COL)("displayedColumns",n.displayedColumns))},directives:[u.mk,m._Y,m.JL,m.sg,P.Q,U.Z,m.Fj,m.JJ,m.u,Z.w9,L.I],pipes:[V.X],styles:[".col-form-label[_ngcontent-%COMP%]{padding-top:0;padding-bottom:0}.form-group.row[_ngcontent-%COMP%]{align-items:center}.activated[_ngcontent-%COMP%]{background-color:#ff8100!important;color:#fff!important}"]}),c})();var G=a(69544),S=a(50282),J=a(7181);let r=(()=>{class c{}return c.\u0275fac=function(e){return new(e||c)},c.\u0275mod=t.oAB({type:c}),c.\u0275inj=t.cJS({imports:[[u.ez,m.u5,m.UX,G.vi,S.fA,Z.A0,J.j,p.Bz.forChild([{path:"",component:R}])]]}),c})()}}]);