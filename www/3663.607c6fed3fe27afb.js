"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3663],{55410:(B,E,n)=>{n.d(E,{Ys:()=>t,ou:()=>l,p3:()=>Y});var D=n(70655),w=n(92340),p=n(38313),h=n(47423),L=(()=>{return(e=L||(L={})).Documents="DOCUMENTS",e.Data="DATA",e.Library="LIBRARY",e.Cache="CACHE",e.External="EXTERNAL",e.ExternalStorage="EXTERNAL_STORAGE",L;var e})();const F=(0,h.fo)("Filesystem",{web:()=>n.e(6364).then(n.bind(n,96364)).then(e=>new e.FilesystemWeb)}),R=(0,h.fo)("BlobWriter");function u(e){const c=new Uint8Array(e);let i="",a=0;for(;!(a>=c.byteLength);)i+=String.fromCharCode(c[a]),a+=1;return window.btoa(i)}function C(e,c,i){if(0===i.size)return Promise.resolve();const a=393216,s=i.slice(0,a);return new window.Response(s).arrayBuffer().then(function(v){return F.appendFile({directory:e,path:c,data:u(v)})}).then(function(){return C(e,c,i.slice(a))})}function A({path:e,directory:c,blob:i,recursive:a}){return F.writeFile({directory:c,path:e,recursive:a,data:""}).then(function({uri:s}){return C(c,e,i).then(function(){return s})})}const T=Object.freeze(function r(e){const{path:c,directory:i,blob:a,recursive:s,on_fallback:f}=e;return"ios"!==h.dV.platform&&"android"!==h.dV.platform?A(e):Promise.all([R.get_config(),F.getUri({path:c,directory:i})]).then(function([g,x]){const{base_url:Z,auth_token:V}=g,j=x.uri.replace("file://","");return Promise.all([fetch(Z+j+(s?"?recursive=true":""),{headers:{authorization:V},method:"put",body:a}),Promise.resolve(x)])}).then(function([v,g]){if(204!==v.status)throw new Error("Bad HTTP status: "+v.status);return g.uri}).catch(function(g){return void 0!==f&&f(g),A(e)})});var m=n(5e3),S=n(40520),b=n(94320),N=n(16164),I=n(43632),M=n(25492),U=n(96115);const P=`${w.N.apiUrl}/attachment-uploader`;let Y=(()=>{class e extends p.i{constructor(i){super(i,P),this.httpClient=i}}return e.\u0275fac=function(i){return new(i||e)(m.LFG(S.eN))},e.\u0275prov=m.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const d=`${w.N.apiUrl}/attachment-downloader`,y=`${w.N.apiUrl}/attachment-downloader/tcs`;let t=(()=>{class e extends p.i{constructor(i,a,s,f,v,g){super(i,d),this.httpClient=i,this.file=a,this.loadingService=s,this.toastService=f,this.alertService=v,this.translate=g}getFile(i){return this.httpClient.get(y+i,{responseType:"blob"})}get(i,a){return this.httpClient.get(y+i,{params:a})}mobileTCSDownload(i,a){return(0,D.mG)(this,void 0,void 0,function*(){URL.createObjectURL(a),this.file.checkDir(this.file.externalRootDirectory,"kbzms_downloads").then(f=>{this.createFile(i,a)}).catch(f=>{this.file.createDir(this.file.externalRootDirectory,"kbzms_downloads",!1).then(v=>{this.createFile(i,a)}).catch(v=>(0,D.mG)(this,void 0,void 0,function*(){console.log(v),yield this.loadingService.deactivate();let g=this.translate.transform("ERROR.file_error");this.alertService.activate(g,"Download File")}))})})}downloadTCSFile(i,a){var s=document.createElement("a");s.href=URL.createObjectURL(i),s.download=a,s.click();let f=this.translate.transform("ERROR.download_success");this.alertService.activate(f,"Download File"),s.remove()}getDownload(i,a){this.httpClient.get(d+"/"+i,{responseType:"blob"}).toPromise().then(s=>{s&&(h.dV.isNativePlatform()?this.mobileDownload(a,s):this.downloadFile(s,a))})}downloadFile(i,a){var s=document.createElement("a");s.href=URL.createObjectURL(i),s.download=a,s.click(),s.remove()}mobileDownload(i,a){return(0,D.mG)(this,void 0,void 0,function*(){try{yield F.mkdir({path:"kbzsale_downloads",directory:L.Documents,recursive:!1}),this.createFile(i,a)}catch(s){this.createFile(i,a)}})}createFile(i,a){return(0,D.mG)(this,void 0,void 0,function*(){try{yield T({path:"kbzsale_downloads/"+i,directory:L.Documents,blob:a}),yield this.loadingService.deactivate(),this.alertService.activate('"Download File',"Success Message")}catch(s){yield this.loadingService.deactivate(),this.alertService.activate('"Download Fail',"Error Message")}})}}return e.\u0275fac=function(i){return new(i||e)(m.LFG(S.eN),m.LFG(b.$),m.LFG(N.b),m.LFG(I.T),m.LFG(M.c),m.LFG(U.K))},e.\u0275prov=m.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const o=`${w.N.apiUrl}/attachment-ref`;let l=(()=>{class e extends p.i{constructor(i){super(i,o),this.httpClient=i}getAttachmentListRef(i,a){return this.httpClient.get(o+"?refDocNo="+i+"&refDocType="+a)}}return e.\u0275fac=function(i){return new(i||e)(m.LFG(S.eN))},e.\u0275prov=m.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()},3663:(B,E,n)=>{n.r(E),n.d(E,{RenewManagementListModule:()=>Y});var D=n(69808),w=n(96592),p=n(70655),h=n(93075),L=n(47423),O=n(39646),G=n(95577),z=n(54004),F=n(70262),R=n(93230),u=n(34436);const C=[{title:"Policy Number",type:u.Y.FEILD,field:"policyNumber"},{title:"Product Code",type:u.Y.FEILD,field:"productCode"},{title:"Agent Name",type:u.Y.FEILD,field:"agentName"},{title:"Premium",type:u.Y.FEILD,field:"premium",amtFormat:!0},{title:"Currency",type:u.Y.FEILD,field:"currency"},{title:"Policy Inception Date",type:u.Y.FEILD,field:"policyInceptionDate"},{title:"Policy Expiry Date",type:u.Y.FEILD,field:"policyExpiryDate"},{title:"Status",type:u.Y.FEILD,field:"status",isRenewStatus:!0},{title:"Actions",type:u.Y.ACTION,field:"actions",btn:{confirm:!0,view:!0,download:!0}}],A=["policyNumber","productCode","agentName","premium","currency","policyInceptionDate","policyExpiryDate","status","actions"];var r=n(5e3),T=n(84161),m=n(25492),S=n(16164),b=n(55410);let N=(()=>{class d{constructor(t,o,l,e,c,i,a){this.fb=t,this.router=o,this.cdf=l,this.renewService=e,this.alertService=c,this.loadingService=i,this.attachmentDownloadService=a,this.ELEMENT_COL=C,this.displayedColumns=A,this.renewList=[],this.activityStatus=u.f,this.downED="attachment-downloader/tcs.htm?fileName=",this.fileNameURL="attachment-downloader/tcs.htm?fileName=",this.loadForm()}ngOnInit(){}ngAfterViewInit(){this.getList()}cancel(){}loadForm(){this.actForm=new h.cw({policyNumber:new h.NI(null),policyHolder:new h.NI(null),startDate:new h.NI(null),endDate:new h.NI(null)})}getList(){this.renewService.getRenewList(this.actForm.value).toPromise().then(t=>{t&&(this.renewList=t,console.log("RenewList",this.renewList),this.cdf.detectChanges(),this.matTable.reChangeData())})}actionBtn(t){console.log("actionBtn",t),"edit"==t.cmd||"view"==t.cmd?this.navigateToDetail(t.data):"confirm"==t.cmd?this.confirmRenew(t.data):"download"==t.cmd&&this.download(t.data.documentName)}isControlValid(t){const o=this.actForm.controls[t];return o.valid&&(o.dirty||o.touched)}isControlInvalid(t){const o=this.actForm.controls[t];return o.invalid&&(o.dirty||o.touched)}controlHasError(t,o){const l=this.actForm.controls[o];return l.hasError(t)&&(l.dirty||l.touched)}isControlTouched(t){const o=this.actForm.controls[t];return o.dirty||o.touched}navigateToDetail(t){this.router.navigate(["sale/renew-policy/detail"],{queryParams:{data:JSON.stringify(t)}})}confirmRenew(t){"confirm"!=t.status&&this.alertService.activate("Are you sure want to confirm?","Warning Message").then(o=>(0,p.mG)(this,void 0,void 0,function*(){o&&this.renewService.confirmRenew(t.policyNumber).toPromise().then(l=>{l&&(console.log(l),this.alertService.activate("This record was updated","Success Message"),this.navigateToDetail(l))})}))}getRenewalList(){this.renewService.getRenewList(this.actForm.getRawValue()).toPromise().then(t=>{t&&(this.renewList=t,this.cdf.detectChanges(),this.matTable&&this.matTable.reChangeData())})}download(t){return(0,p.mG)(this,void 0,void 0,function*(){yield this.loadingService.activate(),this.getfileExt(t).pipe((0,G.z)(o=>{let l=o?o.docExtension:"pdf";return this.attachmentDownloadService.getFile(this.downED+t+"."+l).pipe((0,z.U)(e=>({data:e,ext:l})))})).toPromise().then(o=>(0,p.mG)(this,void 0,void 0,function*(){o&&(L.dV.isNativePlatform()?this.attachmentDownloadService.mobileTCSDownload(t+"."+o.ext,o.data):(yield this.loadingService.deactivate(),this.attachmentDownloadService.downloadTCSFile(o.data,t+"."+o.ext))),yield this.loadingService.deactivate()})).catch(o=>(0,p.mG)(this,void 0,void 0,function*(){yield this.loadingService.deactivate()}))})}getfileExt(t){return this.attachmentDownloadService.get(this.fileNameURL+t).pipe((0,F.K)(()=>(0,O.of)(null)))}}return d.\u0275fac=function(t){return new(t||d)(r.Y36(h.qu),r.Y36(w.F0),r.Y36(r.sBO),r.Y36(T.R),r.Y36(m.c),r.Y36(S.b),r.Y36(b.Ys))},d.\u0275cmp=r.Xpm({type:d,selectors:[["app-renew-management-list"]],viewQuery:function(t,o){if(1&t&&r.Gf(R.I,5),2&t){let l;r.iGM(l=r.CRH())&&(o.matTable=l.first)}},decls:5,vars:3,consts:[[1,"row"],[1,"col-12"],[1,"card","card-custom","gutter-b"],[1,"card-body","customer-card-body"],[3,"data","colum","displayedColumns","emitter"]],template:function(t,o){1&t&&(r.TgZ(0,"div",0),r.TgZ(1,"div",1),r.TgZ(2,"div",2),r.TgZ(3,"div",3),r.TgZ(4,"app-material-table-view",4),r.NdJ("emitter",function(e){return o.actionBtn(e)}),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.qZA()),2&t&&(r.xp6(4),r.Q6J("data",o.renewList)("colum",o.ELEMENT_COL)("displayedColumns",o.displayedColumns))},directives:[R.I],styles:[".col-form-label[_ngcontent-%COMP%]{padding-top:0;padding-bottom:0}.form-group.row[_ngcontent-%COMP%]{align-items:center}"]}),d})();var I=n(69544),M=n(50282),U=n(64537),P=n(7181);let Y=(()=>{class d{}return d.\u0275fac=function(t){return new(t||d)},d.\u0275mod=r.oAB({type:d}),d.\u0275inj=r.cJS({imports:[[D.ez,h.u5,h.UX,I.vi,M.fA,U.A0,P.j,w.Bz.forChild([{path:"",component:N}])]]}),d})()}}]);